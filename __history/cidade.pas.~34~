unit cidade;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs, FMX.ListBox,
  FMX.StdCtrls, FMX.Edit, FMX.Controls.Presentation, FMX.Layouts;

type
  TForm2 = class(TForm)
    ScaledLayout1: TScaledLayout;
    Label1: TLabel;
    e_cod: TEdit;
    e_nome: TEdit;
    Button1: TButton;
    Label4: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Button2: TButton;
    cb_uf: TComboBox;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form2: TForm2;

implementation

{$R *.fmx}

uses u_dm, login;

procedure TForm2.Button1Click(Sender: TObject);
begin
    if (Trim(e_cod) <> ' ') or (Trim(e_nome) <> ' ') or (Trim(cb_uf.Items[cb_uf.ItemIndex]) <> ' ') then
        begin
        //buscar os cods da cidade
            with dm.sql_cidread do
            begin
                    close;
                    sql.Clear;
                    sql.Add('SELECT * FROM cidade WHERE cid_cod=:pcod');
                    parambyname('pcod').Value := StrToInt(e_cod.Text);
                    open;
                if (recordcount > 0 ) then   //Continuar apenas se a
                    //busca não retornou algum código já cadastrado
                    begin
                      with dm.sql_cidade do
                      begin
                        close;
                        sql.Clear;
                        Sql.Add('INSERT INTO cidade VALUES (:pcod, :pnome, :puf)');
                        parambyname('pcod').Value := StrToInt(e_cod.Text);
                        parambyname('pnome').Value := e_nome;
                        parambyname('puf').Value := cb_uf.Items[cb_uf.ItemIndex];
                        ExecSql;
                        ShowMessage ('A cidade '+e_nome+' foi cadastrada com sucesso');

                      end;

                     dm.sql_cidread.Close;
                     dm.sql_cidread.sql.Clear;
                     dm.sql_cidread.sql.Add('SELECT * FROM cidade');
                     dm.sql_cidread.Open;
                     // fechar form, pois já cadastrou
                     self.Close;


                    end
                    else
                    begin
                      ShowMessage('O código '+e_cod.Text+ ' já foi cadastrado!');
                      e_cod.Text := '';
                      e_cod.SetFocus;

                    end;

            end;


        end
    else
      begin
          ShowMessage('Preencha todos os campos!');
          e_cod.SetFocus;
          e_cod.Text := '';
          e_nome.Text := '';
          cb_uf.Items[cb_uf.ItemIndex] := '';
      end;


end;

procedure TForm2.Button2Click(Sender: TObject);
begin
    form_login.Show;
    close;
end;

end.
